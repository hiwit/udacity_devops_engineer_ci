# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

commands:
  say-hey:
    description: "says hey"
    parameters:
      to:
        type: string
        default: "hey world"
    steps:
      - run: echo <<parameters.to>>

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs

defaults: &defaults
  docker:
    - image: circleci/node:13.8.0
jobs:
  build:
    <<: *defaults
    steps:
      - checkout
      - run: npm install
      - save_cache:
          key: "npm-cache"
          paths:
            - node_modules
  test:
    <<: *defaults
    steps:
      - checkout
      - restore_cache:
          key: "npm-cache"
      - run: |
          ls -la 
          cat package.json
          ls -la node_modules
      - run: npm test
  analzye:
    <<: *defaults
    steps:
      - checkout
      - restore_cache:
          key: "npm-cache"
      - run: npm audit          
        
# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  build-and-test:
    jobs:
      - build
      - test:
          requires:
            - build
      - analzye:
          requires:
            - test